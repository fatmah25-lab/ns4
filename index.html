
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ููุณูุฉ โ ุจูุงุจุฉ ุงูุถูุงูุฉ ุงูุฐููุฉ</title>
<style>
  :root{
    --bg1:#f7f3ee; --accent:#b58b4b; --muted:#6e5a46; --card:#fffdf7;
    --success:#2e7d32; --danger:#d32f2f;
  }
  *{box-sizing:border-box}
  body{font-family: "Cairo",sans-serif; margin:0; background:linear-gradient(180deg,var(--bg1),#fff); color:var(--muted);}
  header{background:var(--accent); color:#fff; padding:18px 12px; display:flex; justify-content:space-between; align-items:center;}
  header h1{margin:0;font-size:1.2rem}
  header .team{font-size:.95rem; opacity:.95}
  nav{display:flex; gap:8px; justify-content:center; padding:12px; flex-wrap:wrap; background:transparent;}
  nav button{background:#fff0e6;border:0;padding:10px 14px;border-radius:8px;cursor:pointer}
  .container{max-width:1100px;margin:18px auto;padding:0 12px;}
  .card{background:var(--card); border-radius:12px; padding:16px; box-shadow:0 6px 18px rgba(0,0,0,0.06); margin-bottom:16px;}
  .sensors{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}
  .sensor{min-width:150px;padding:12px;border-radius:10px;background:#f6f1ea;text-align:center}
  .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:10px}
  button.big{padding:10px 18px;border-radius:10px;border:0;background:var(--accent);color:#fff;cursor:pointer}
  button.small{padding:8px 12px;border-radius:8px;border:0;background:#eee;cursor:pointer}
  .active{box-shadow:0 0 12px rgba(181,139,75,0.6)}
  .flex{display:flex;gap:12px;align-items:center}
  input[type="text"], select{padding:8px;border-radius:8px;border:1px solid #e0d6c7}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  footer{text-align:center;color:#fff;background:var(--accent);padding:12px;border-radius:0 0 8px 8px;margin-top:18px}
  iframe.map{width:100%;height:420px;border:1px solid #e9e0d3;border-radius:8px}
  pre.note{background:#fff7f0;padding:10px;border-radius:8px;color:#7a5e3a;font-size:0.95rem}
  @media (max-width:900px){ .sensors{flex-direction:column;align-items:stretch} .row{flex-direction:column} header{flex-direction:column;gap:8px;align-items:flex-start} }
</style>
</head>
<body>

<header>
  <div>
    <h1>๐ฟ ููุณูุฉ โ ุจูุงุจุฉ ุงูุถูุงูุฉ ุงูุฐููุฉ</h1>
    <div style="font-size:0.85rem;opacity:.95">ุชุฌุฑุจุฉ ุญุณููุฉ ูุณูุงุญูุฉ ุฐููุฉ โ ุงูุถูุงูุฉ ุงูุนุฑุจูุฉ ุชูุชูู ุจุงูุชูููุฉ</div>
  </div>
  <div class="team">ูุฑูู <strong>ุขูุงู ุงูุณูุงุญุฉ</strong></div>
</header>

<nav id="nav">
  <button data-view="home">ุงูุฑุฆูุณูุฉ</button>
  <button data-view="guide">ุฏููู ุงูุฒุงุฆุฑ</button>
  <button data-view="maps">ุงูุฎุฑูุทุฉ (ุธูุงุฑ)</button>
  <button data-view="currency">ูุญูู ุงูุนููุงุช</button>
  <button data-view="recommend">ุงูุชุฑุงุญ ุฐูู</button>
  <button data-view="about">ุนู ุงููุดุฑูุน</button>
</nav>

<div class="container">
  <!-- HOME -->
  <section id="home" class="view card">
    <h2>ุญุงูุฉ ุงููุงุญุฉ ุงูุฐููุฉ</h2>
    <div class="sensors">
      <div class="sensor">
        <h4>ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ</h4>
        <div id="temp">-- ยฐC</div>
      </div>
      <div class="sensor">
        <h4>ุงูุฑุทูุจุฉ</h4>
        <div id="hum">-- %</div>
      </div>
      <div class="sensor">
        <h4>ุฌูุฏุฉ ุงูููุงุก</h4>
        <div id="air">--</div>
      </div>
      <div class="sensor">
        <h4>ุงููุฑูุญุฉ</h4>
        <div id="fan">--</div>
      </div>
    </div>

    <div class="card" style="margin-top:14px;">
      <h3>ุชุญูู ุงูุฑูุงุฆุญ</h3>
      <div class="controls">
        <button id="btn-coffee" class="big">โ ุงููููุฉ</button>
        <button id="btn-oud" class="big">๐ฟ ุงูุนูุฏ</button>
        <button id="btn-musk" class="big">๐ธ ุงููุณู</button>
      </div>
      <p style="margin-top:10px;color:#7a6b5a;font-size:0.95em">ููููู ุงูุชุญูู ุจุงูุฑูุงุฆุญ ูุจุงุดุฑุฉ ูู ููุง ุฃู ูู ูุงุฌูุฉ ุงููESP32/ุงูุชุทุจูู.</p>
    </div>
    <div class="card">
      <h3>ููุงุญุธุฉ ุชุดุบูููุฉ</h3>
      <pre class="note">ูุจู ุงูุนุฑุถ: ุถุน ุนููุงู ุงููESP32 ูู ุงููุชุบูุฑ ESP32_IP ูู ุงูููุฏ ุฃุณูู ุงูุตูุญุฉ. ุฅุฐุง ุดูุบูู ุงููููุน ูู GitHub Pages ุชุฃูุฏ ุฃู ุงูุชุงุจูุช ูุชุตู ุจููุณ ุงูุดุจูุฉ ุงููุญููุฉ ุฃู ูุนูู CORS ุนูู ESP32 (server.sendHeader("Access-Control-Allow-Origin","*");).</pre>
    </div>
  </section>

  <!-- GUIDE -->
  <section id="guide" class="view card" style="display:none;">
    <h2>๐บ๏ธ ุฏููู ุงูุฒุงุฆุฑ โ ููุงุทู ูุฎุชุงุฑุฉ ูู ุธูุงุฑ</h2>
    <p>ุจุทุงูุงุช ุชุนุฑูููุฉ ูุฎุชุตุฑุฉ ูุฃูู ููุงูุน ูุญุงูุธุฉ ุธูุงุฑ (ุตูุงูุฉ ูุงูููุงุทู ุงููุญูุทุฉ).</p>
    <div id="places" class="row"></div>
  </section>

  <!-- MAPS -->
  <section id="maps" class="view card" style="display:none;">
    <h2>ุฎุฑูุทุฉ ูุญุงูุธุฉ ุธูุงุฑ โ ุตูุงูุฉ ูุงูููุงุทู ุงููุญูุทุฉ</h2>
    <!-- Google Maps Embed (ูุฑูุฒุฉ ุนูู ุธูุงุฑ) -->
    <iframe class="map" src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d241183.07139584523!2d54.035!3d17.014!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sar!2som!4v1697040000000" allowfullscreen="" loading="lazy"></iframe>
    <p style="margin-top:8px;color:#6b5a48;font-size:0.95em">ุงูุฎุฑูุทุฉ ูุชูุฑูุฒุฉ ุนูู ูุญุงูุธุฉ ุธูุงุฑ โ ุตูุงูุฉ. ุงุถุบุท ุนูู ุงูุนูุงูุงุช ุฏุงุฎู ุงูุฎุฑูุทุฉ ููุฒูุฏ ูู ุงูุชูุงุตูู.</p>
  </section>

  <!-- CURRENCY -->
  <section id="currency" class="view card" style="display:none;">
    <h2>๐ฑ ูุญูู ุงูุนููุงุช</h2>
    <div class="row">
      <div style="flex:1">
        <label>ุงููุจูุบ</label><br>
        <input type="text" id="amount" value="1">
      </div>
      <div style="flex:1">
        <label>ูู</label><br>
        <select id="from">
          <option value="OMR">ุฑูุงู ุนูุงูู (OMR)</option>
          <option value="SAR">ุฑูุงู ุณุนูุฏู (SAR)</option>
          <option value="USD">ุฏููุงุฑ ุฃูุฑููู (USD)</option>
          <option value="EUR">ููุฑู (EUR)</option>
        </select>
      </div>
      <div style="flex:1">
        <label>ุฅูู</label><br>
        <select id="to">
          <option value="USD">ุฏููุงุฑ ุฃูุฑููู (USD)</option>
          <option value="SAR">ุฑูุงู ุณุนูุฏู (SAR)</option>
          <option value="EUR">ููุฑู (EUR)</option>
          <option value="OMR">ุฑูุงู ุนูุงูู (OMR)</option>
        </select>
      </div>
    </div>
    <div style="margin-top:12px;">
      <button id="convertBtn" class="big">ุชุญููู</button>
    </div>
    <div style="margin-top:12px;">
      <h3>ุงููุชูุฌุฉ: <span id="convResult">--</span></h3>
      <p style="font-size:0.9em;color:#6b5a48">ุงููุตุฏุฑ: exchangerate.host</p>
    </div>
  </section>

  <!-- RECOMMEND -->
  <section id="recommend" class="view card" style="display:none;">
    <h2>๐งญ ุงูุชุฑุงุญ ุฐูู ููุฒุงุฆุฑ</h2>
    <p>ุงุฎุชุฑ ุชูุถููู ูุณููุชุฑุญ ุชุฌุฑุจุฉ ููุงุณุจุฉ:</p>
    <div class="row">
      <select id="pref">
        <option value="relax">ุฑุงุญุฉ ูุงุณุชุฌูุงู</option>
        <option value="culture">ุซูุงูุฉ ูุชุฑุงุซ</option>
        <option value="adventure">ูุบุงูุฑุฉ ููุดุงุท</option>
        <option value="food">ุชุฌุฑุจุฉ ุทุนุงู/ูููุฉ</option>
      </select>
      <button id="getRec" class="small">ุงุญุตู ุนูู ุงูุชุฑุงุญ</button>
    </div>

    <div style="margin-top:14px;" id="recBox" class="card">
      <h3>ุงูุงูุชุฑุงุญ</h3>
      <p id="recText" style="font-size:1.05em;color:#554433">โ</p>
    </div>
    <p style="margin-top:8px;color:#666;font-size:0.9em">ุงูุชูุตูุฉ ุชุนุชูุฏ ุนูู ุจูุงูุงุช ุงูุฌู ุงูุญุงููุฉ (ุงูุชู ูุฒูุฏูุง ูุธุงู ุงููุงุญุฉ) ูุชูุถููู.</p>
  </section>

  <!-- ABOUT -->
  <section id="about" class="view card" style="display:none;">
    <h2>ุนู ููุณูุฉ</h2>
    <p>ููุณูุฉ ูู ุจูุงุจุฉ ุงูุถูุงูุฉ ุงูุฐููุฉ ุงูุชู ุชุฏูุฌ ุงูุชุญูู ุงูุจูุฆู ุจุงูุชุฑุงุซ ุงูุนุฑุจู โ ุฑุงุฆุญุฉ ุงููููุฉุ ุงูุนูุฏุ ูุงููุณู โ ูุน ูุนูููุงุช ุณูุงุญูุฉ ุฐููุฉ ูุชุฌุฑุจุฉ ุฑูููุฉ ูุชูุงููุฉ.</p>
    <p>ุงููุฑูู: <strong>ุขูุงู ุงูุณูุงุญุฉ</strong></p>
  </section>
</div>

<footer>ยฉ 2025 ููุณูุฉ โ ุจูุงุจุฉ ุงูุถูุงูุฉ ุงูุฐููุฉ</footer>

<script>
/* =========================
   ุฅุนุฏุงุฏุงุชู: ุถุน IP ุงููESP32 ููุง
   ========================= */
const ESP32_IP = "192.168.1.55"; // ุบููุฑู ูุนููุงู ุฌูุงุฒู ุงููุญูู (ููุทุฉ ูููุฉ ููุนุฑุถ)

/* ---------- ุชูููู ุจูู ุงูุตูุญุงุช ---------- */
document.querySelectorAll('#nav button').forEach(btn=>{
  btn.addEventListener('click', ()=> {
    const view = btn.getAttribute('data-view');
    document.querySelectorAll('.view').forEach(v=>v.style.display='none');
    document.getElementById(view).style.display='block';
  });
});

/* ---------- ุชุญุฏูุซ ุญุณูุงุณุงุช ูู ESP32 ---------- */
async function updateSensors(){
  try{
    const res = await fetch(`http://${ESP32_IP}/sensors`, {cache:'no-store'});
    if(!res.ok) throw new Error('no data');
    const data = await res.json();
    document.getElementById('temp').innerText = data.temp + ' ยฐC';
    document.getElementById('hum').innerText = data.hum + ' %';
    document.getElementById('air').innerText = data.air;
    document.getElementById('fan').innerText = (parseInt(data.air) > 400) ? 'ุชุดุบูู' : 'ุฅููุงู';
  }catch(e){
    document.getElementById('temp').innerText = '-- ยฐC';
    document.getElementById('hum').innerText = '-- %';
    document.getElementById('air').innerText = '--';
    document.getElementById('fan').innerText = '--';
    console.warn('ุชุนุฐุฑ ุงููุตูู ูููESP32:', e);
  }
}
setInterval(updateSensors,3000); updateSensors();

/* ---------- ุฃูุงูุฑ ุงูุฑูุงุฆุญ (ูู ุงููููุน ุฅูู ESP32) ---------- */
function sendCmd(type, state){
  fetch(`http://${ESP32_IP}/${type}?state=${state}`).catch(e=>console.warn('cmd err',e));
}
document.getElementById('btn-coffee').addEventListener('click', function(){
  const active = this.classList.toggle('active');
  sendCmd('coffee', active?1:0);
});
document.getElementById('btn-oud').addEventListener('click', function(){
  const active = this.classList.toggle('active');
  sendCmd('oud', active?1:0);
});
document.getElementById('btn-musk').addEventListener('click', function(){
  const active = this.classList.toggle('active');
  sendCmd('musk', active?1:0);
});

/* ---------- ูุญูู ุงูุนููุงุช (exchangerate.host) ---------- */
document.getElementById('convertBtn').addEventListener('click', async ()=>{
  const amount = parseFloat(document.getElementById('amount').value) || 1;
  const from = document.getElementById('from').value;
  const to = document.getElementById('to').value;
  const url = `https://api.exchangerate.host/convert?from=${from}&to=${to}&amount=${amount}`;
  try{
    const res = await fetch(url);
    const json = await res.json();
    if(json.success){
      document.getElementById('convResult').innerText = `${json.result.toFixed(3)} ${to}`;
    } else {
      document.getElementById('convResult').innerText = 'ูุดู ุงูุญุตูู ุนูู ุงูุณุนุฑ';
    }
  }catch(e){
    document.getElementById('convResult').innerText = 'ุฎุทุฃ ูู ุงูุงุชุตุงู';
    console.warn(e);
  }
});

/* ---------- ูุญุชูู ุฏููู ุงูุฒุงุฆุฑ (ุฃูุซูุฉ ููููุฉ ูููุทูุฉ ุธูุงุฑ) ---------- */
const places = [
  {title:'ุณุงุญุฉ ุงูุชุฑุงุซ (ุตูุงูุฉ)', desc:'ุฌูุณุงุช ูููุฉ ุนุฑุจูุฉ ูุนุฑูุถ ุชูููุฏูุฉ', tag:'ูููุฉ', coords:[17.015,54.091]},
  {title:'ูุชุญู ุธูุงุฑ', desc:'ุชุงุฑูุฎ ุงูููุทูุฉ ูุชุฑุงุซูุง ุงูุจุญุฑู', tag:'ุซูุงูุฉ', coords:[17.044,54.087]},
  {title:'ููุฏุงู ุงููุซุจุงู (ุธูุงุฑ)', desc:'ูุดุงุทุงุช ุฑูููุฉ ููุบุงูุฑุงุช', tag:'ูุบุงูุฑุฉ', coords:[16.950,54.120]},
  {title:'ูุทุนู ุงูุนูุฏ (ุตูุงูุฉ)', desc:'ุฃุทุจุงู ุนุฑุจูุฉ ููููุฉ ุชูููุฏูุฉ', tag:'ุทุนุงู', coords:[17.020,54.100]}
];
const placesDiv = document.getElementById('places');
places.forEach(p=>{
  const el = document.createElement('div');
  el.className = 'card';
  el.style.flex='1 1 220px';
  el.style.minWidth='220px';
  el.innerHTML = `<h4>${p.title}</h4><p style="color:#6b5a48">${p.desc}</p><p style="font-size:0.9em;color:#8a755f">ููุน: ${p.tag}</p>`;
  placesDiv.appendChild(el);
});

/* ---------- ูุธุงู ุงูุชูุตูุงุช ุงูุจุณูุท (ุฐูุงุก ูุญูู) ---------- */
document.getElementById('getRec').addEventListener('click', async ()=>{
  const pref = document.getElementById('pref').value;
  // ููุฑุฃ ุงูููู ุงูุญููููุฉ ูุจู ุงูุชุฑุงุญ
  let temp= null, hum=null, air=null;
  try{
    const res = await fetch(`http://${ESP32_IP}/sensors`, {cache:'no-store'});
    const json = await res.json();
    temp = parseFloat(json.temp); hum = parseFloat(json.hum); air = parseInt(json.air);
  }catch(e){
    temp = 30; hum = 45; air = 350;
  }

  let rec = '';
  if(air > 400) {
    rec = 'ุงูููุงุก ุบูุฑ ููู ุงูุขูุ ููุตุญ ุจุงูุฌููุณ ุฏุงุฎู ุงููุงุญุฉ ุญูุซ ูุนูู ูุธุงู ุงูุชูููุฉ ูุชุฌุฑุจุฉ ุฑุงุฆุญุฉ ุงููุณู.';
  } else {
    if(pref === 'relax'){
      rec = (temp>33) ? 'ุงูุฌู ุญุงุฑุ ุชุฌุฑุจุฉ ุฑูู ุงููููุฉ ุฏุงุฎู ุงููุธูุฉ ุณุชููู ูุฑูุญุฉ.' : 'ุฌูุณุฉ ุงููุณู ูู ุงููุณุงุก ูุน ุฅุถุงุกุฉ ุฏุงูุฆุฉ ุณุชููู ูุซุงููุงู.';
    } else if(pref === 'culture'){
      rec = 'ุฒูุฑ ูุชุญู ุธูุงุฑ ูุชุนุฑูู ุนูู ุงูุญุฑู ุงููุญููุฉุ ุซู ุงุณุชูุชุน ุจููุฌุงู ูููุฉ ุนุฑุจูุฉ.';
    } else if(pref === 'adventure'){
      rec = (temp<30) ? 'ุงูุทูู ุฅูู ููุฏุงู ุงููุซุจุงู ูุฌููุฉ ูุตูุฑุฉ ูุน ุฏููู ูุญูู.' : 'ุงูููุช ุญุงุฑุ ุงูุชุฑุญ ุฌููุฉ ุนูุฏ ุงูุบุฑูุจ.';
    } else if(pref === 'food'){
      rec = 'ุฒูุฑ ูุทุนู ุงูุนูุฏ ูู ุตูุงูุฉ ูุชุฐูู ุฃุทุจุงู ุงูุถูุงูุฉ ูุงููููุฉ ุงูุชูููุฏูุฉ.';
    }
  }
  document.getElementById('recText').innerText = rec;
});

/* ---------- ุงุฎุชูุงุฑ ุงูุตูุญุฉ ุงูุงูุชุฑุงุถูุฉ ---------- */
window.addEventListener('load', ()=> {
  document.querySelector('#nav button[data-view="home"]').click();
});
</script>

</body>
</html>
